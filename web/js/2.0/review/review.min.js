var rkKanjiReview={initialize:function(a){this.options=a;a.fcr_options.events={onBeginReview:this.onBeginReview.bind(this),onEndReview:this.onEndReview.bind(this),onFlashcardCreate:this.onFlashcardCreate.bind(this),onFlashcardDestroy:this.onFlashcardDestroy.bind(this),onFlashcardState:this.onFlashcardState.bind(this),onFlashcardUndo:this.onFlashcardUndo.bind(this),onAction:this.onAction.bind(this)};this.oReview=new uiFlashcardReview(a.fcr_options);this.oReview.addShortcutKey("f","flip");this.oReview.addShortcutKey(" ","flip");this.oReview.addShortcutKey("n","no");this.oReview.addShortcutKey("y","yes");this.oReview.addShortcutKey("e","easy");this.oReview.addShortcutKey("u","undo");this.oReview.addShortcutKey("s","story");this.elFlashcard=$$("div.uiFcCard")[0];this.elUndo=$$(".uiFcReview a.uiFcAction-undo")[0];this.elStats=$$(".uiFcReview .uiFcStats")[0];this.elCount=this.elStats.select(".count");this.elProgressBar=$("review-progress").getElementsByTagName("span")[0];this.elAnswerPass=this.elStats.select("p.pass")[0];this.elAnswerFail=this.elStats.select("p.fail")[0];this.countYes=0;this.countNo=0;this.elFinish=this.elStats.select(".finish")[0]},getOption:function(a){return this.options[a]},onBeginReview:function(){},onEndReview:function(){this.updateStatsPanel();var a=$("uiFcRedirectForm");a.method="post";a.action=this.getOption("end_url");a.elements.fc_pass.value=this.countYes;a.elements.fc_fail.value=this.countNo;a.submit()},onFlashcardCreate:function(){if(this.oReview.getPosition()==0){this.elStats.style.display="block"}this.elUndo.style.display=this.oReview.getNumUndos()?"block":"none";this.updateStatsPanel()},onFlashcardDestroy:function(){$("uiFcButtons0").hide();$("uiFcButtons1").hide()},onFlashcardUndo:function(a){this.updateAnswerStats(a.r>1?-1:0,a.r===1?-1:0)},onFlashcardState:function(a){if(a===0){$("uiFcButtons0").show();$("uiFcButtons1").hide()}else{$("uiFcButtons0").hide();$("uiFcButtons1").show()}},onAction:function(e){var b=false;uiConsole.log("rkKanjiReview.onAction(%o)",arguments);if(!this.oReview.getFlashcard()){return}if(e==="story"){if(this.storyWindow&&this.storyWindow.isVisible()){this.storyWindow.hide()}else{var a=this.oReview.getFlashcardData();if(!this.storyWindow){var d=this.elFlashcard.offsetLeft+(this.elFlashcard.offsetWidth/2)-(520/2);var c=this.elFlashcard.offsetTop+61;this.storyWindow=new rkEditStoryWindow(a.id,{left:d,top:c,editstory_url:this.getOption("editstory_url")})}else{this.storyWindow.loadFramenum(a.id);this.storyWindow.show()}}return}switch(e){case"flip":if(this.oReview.getFlashcardState()==0){this.oReview.setFlashcardState(1)}return;break;case"undo":if(this.oReview.getNumUndos()>0){this.oReview.backward()}return;break;case"end":this.oReview.endReview();return;break;case"no":b=1;break;case"yes":b=2;break;case"easy":b=3;break}if(!this.oReview.getFlashcardState()){return}var a=this.oReview.getFlashcardData();if(b){var f={id:a.id,r:b};this.oReview.answerCard(f);this.updateAnswerStats(b>1?1:0,b===1?1:0);this.oReview.forward();return}return},updateStatsPanel:function(){var b=this.oReview.getItems(),c=b.length,a=this.oReview.getPosition();this.updateProgress(a,c)},updateProgress:function(b,c){this.elCount[0].innerHTML=b;this.elCount[1].innerHTML=c;var a=b>0?Math.ceil(b*100/c):0;a=Math.min(a,100);this.elProgressBar.style.width=(a>0?a:0)+"%"},updateAnswerStats:function(b,a){this.countYes+=b;this.countNo+=a;this.elAnswerPass.innerHTML=this.countYes;this.elAnswerFail.innerHTML=this.countNo},setButtonState:function(b,c){var a=$(b).select("a.uiIBtn");a.each(function(d){if(c){d.removeClassName("uiFcBtnDisabled")}else{d.addClassName("uiFcBtnDisabled")}})}};