var StudyPage={initialize:function(b){this.options=b;this.elSearch=$("txtSearch");var a=this.actb1=new actb(this.elSearch,kwlist);a.onChangeCallback=this.quicksearchOnChangeCallback.bind(this);a.onPressEnterCallback=this.quicksearchEnterCallback.bind(this);a.actb_extracolumns=function(c){return'<span class="framenum">'+(c+1)+'</span><span class="k">&#'+kklist.charCodeAt(c)+";</span>"};this.elSearch.onfocus=function(){if(this.value!==""){this.select()}};if(this.elSearch&&this.elSearch.value===""){this.elSearch.focus()}if($("EditStoryComponent")){this.editStoryComponent=new EditStoryComponent($("EditStoryComponent"))}if($("SharedStoriesComponent")){this.sharedStoriesComponent=new SharedStoriesComponent($("SharedStoriesComponent"))}},quicksearchOnChangeCallback:function(a){if(a.length>0){a=a.replace(/\//,"_");window.location.href=this.options.URL_SEARCH+"/"+encodeURIComponent(a);return true}},quicksearchEnterCallback:function(a){this.quicksearchOnChangeCallback(a)}};var SharedStoriesComponent=Class.create();SharedStoriesComponent.prototype={initialize:function(a){this.evtCache=new uiEventCache();this.evtCache.addEvents(a,["mouseover","mouseout","click"],this.evEventHandler.bind(this));this.ajaxPanel=new uiAjaxPanel(a,{post_url:StudyPage.options.URL_SHAREDSTORIES,events:{onContentInit:this.onContentInit.bind(this),onContentDestroy:this.onContentDestroy.bind(this)},bUseShading:true})},destroy:function(){this.evtCache.destroy()},reload:function(){var a={framenum:document.forms.EditStory.elements.framenum.value};this.ajaxPanel.get(a)},onContentInit:function(){},onContentDestroy:function(){},evEventHandler:function(m){var c=m.element();var b=m.findElement("div");if(!b){return}if(b.className.indexOf("JsNewest")>=0){var h=m.type==="mouseover"?-33:0;b.style.backgroundPosition="0 "+h+"px";if(m.type==="click"){var e=$("sharedstories-new");if(!this.hideStories){$(e).addClassName("JsHide");this.hideStories=true}else{$(e).removeClassName("JsHide");this.hideStories=false}}m.stop();return false}if(b.className!=="action"){return}var k=b?b.getElementsByTagName("span")[0]:null;switch(m.type){case"mouseover":var i={star:"Star this story",report:"Report this story",copy:"Copy this story"};var f=i[c.className]||"";if(f){k.className="";k.innerHTML=f}break;case"mouseout":if(k){var n=k.getAttribute("lastmsg")||"";k.className=n?"msg":"";k.innerHTML=n}break;case"click":var a=b.id.split("-");var l=(new Date()).getTime();var j=this.lastclick?(l-this.lastclick):1000;this.lastclick=l;if(j<300||this.ajaxRequest){k.className="err";k.innerHTML="Not too fast buddy!";break}var d={uid:a[1],sid:a[2]};if(/star/.test(c.className)){d.request="star"}else{if(/report/.test(c.className)){d.request="report"}else{if(/copy/.test(c.className)){d.request="copy"}}}if(d.request){var g=this;options={method:"post",parameters:d,onSuccess:this.handleResponse.bind(this),onComplete:function(){g.ajaxRequest=null}};this.ajaxRequest=new uiAjaxRequest(StudyPage.options.URL_SHAREDSTORIES,options);k.className="";k.innerHTML="..."}break}m.stop();return false},handleResponse:function(h){var e=h.responseText.evalJSON();if(e){if(e.text){var d=document.forms.EditStory;if(d){d.elements.chkPublic.checked=false;var j=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;window.scrollTo(j,0);StudyPage.editStoryComponent.editStory(e.text)}return}var a=$("story-"+e.uid+"-"+e.sid);var g=a.getElementsByTagName("span")[0];if(e.vote>=0){var b=a.getElementsByTagName("a");if(!e.vote&&e.lastvote){var i="Vote cancelled"}else{if(e.vote==1){var i="Starred!"}else{if(e.vote==2){var i="Reported"}}}var c=a.getAttribute("appv1")||"0";var f=a.getAttribute("appv2")||"0";c=parseInt(c)+parseInt(e.stars);f=parseInt(f)+parseInt(e.kicks);a.setAttribute("appv1",c);a.setAttribute("appv2",f);b[0].innerHTML=c?c+"&nbsp;":"&nbsp;";b[1].innerHTML=f?f+"&nbsp;":"&nbsp;";if(i){g.innerHTML=i;g.className="msg";g.setAttribute("lastmsg",i)}}else{var i="No self vote!";g.innerHTML=i}}}};