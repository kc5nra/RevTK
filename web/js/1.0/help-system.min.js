/* HelpSystem (c)2008 Fabrice Denis - http://kanji.koohii.com */
var HelpSystem=Class.create();HelpSystem.prototype={HS_POS_RIGHT:1,HS_POS_BOTTOM:2,HS_POS_TOP:3,HS_POS_MIDDLE:4,HS_ARROW_WIDTH:19,HS_ARROW_HEIGHT:19,default_pos:{x:106,y:163},default_width:241,initialize:function(){if(this.htmlTemplate){var c=document.createElement("div");var a=$("ie")||document.getElementsByTagName("body")[0];c.innerHTML=this.htmlTemplate;a.appendChild(c)}this.layer=$("hs-layer");this.arrow=this.layer.getElementsByTagName("div")[0];if(!this.layer){alert("HelpSystem:: layer not found!");return}this.layer.style.position="absolute";this.layer.style.zIndex="100";this.layer.style.width=this.default_width+"px";var b=this.layer.getElementsByTagName("tfoot")[0];this.backLink=b.getElementsByTagName("a")[0];this.nextLink=b.getElementsByTagName("a")[1];this.stepSpan=this.layer.getElementsByTagName("span")[0];this.closeLink=b.getElementsByTagName("a")[2];this.steps=[]},add:function(a){this.steps.push(a)},start:function(){this.layer.style.display="block";this.layer.onclick=this.eventHandler.bindAsEventListener(this);var a;for(a=1;a<this.steps.length;a++){if(!this.steps[a].ttl){this.steps[a].ttl=this.steps[a-1].ttl}if(!this.steps[a].pos&&this.steps[a-1].pos){this.steps[a].pos=this.steps[a-1].pos;this.steps[a].ele=this.steps[a-1].ele}}this.oldpos=false;this.step=0;this.show()},show:function(){var g=this.steps[this.step];this.layer.style.display="none";this.backLink.style.display=(this.step>0)?"":"none";this.nextLink.style.display=(this.step<this.steps.length-1)?"":"none";this.closeLink.style.display=(this.step<this.steps.length-1)?"":"block";this.stepSpan.innerHTML=(this.step+1)+"/"+this.steps.length;var d=null;var h=0;for(param in g){switch(param){case"ttl":this.layer.getElementsByTagName("th")[0].innerHTML=g[param];break;case"msg":this.layer.getElementsByTagName("tbody")[0].getElementsByTagName("td")[0].innerHTML=g[param];break;case"ele":d=g[param]();break;case"pos":h=g[param];break}}var e=false;if(d||this.step==0){var a=d?dom.findPosition(d):false;var f,b;switch(h){case this.HS_POS_RIGHT:e={x:a[0]+d.offsetWidth,y:a[1]+d.offsetHeight/2};f={x:-19,y:29-this.HS_ARROW_HEIGHT/2};b={x:e.x+this.HS_ARROW_WIDTH,y:e.y-29};break;case this.HS_POS_BOTTOM:e={x:a[0]+d.offsetWidth/2,y:a[1]+d.offsetHeight};f={x:this.default_width/2-this.HS_ARROW_WIDTH/2,y:-19};b={x:e.x-this.default_width/2,y:e.y+this.HS_ARROW_HEIGHT};break;case this.HS_POS_TOP:e={x:a[0]+d.offsetWidth/2,y:a[1]};f={x:this.default_width/2-this.HS_ARROW_WIDTH/2,y:0};b={x:e.x-this.default_width/2,y:e.y-this.HS_ARROW_HEIGHT};break;case this.HS_POS_MIDDLE:e={x:a[0]+d.offsetWidth/2,y:a[1]+d.offsetHeight/3};f=false;b={x:e.x-this.default_width/2,y:e.y};break;default:if(this.step==0){f=false;b=this.default_pos}break}var c=this;window.setTimeout(function(){var j=$("mainright");if(j){var l=dom.findPosition(j);var i=(b.x+c.default_width)-(l[0]+j.offsetWidth);if(i>0){b.x-=(i+8);if(h==c.HS_POS_TOP||h==c.HS_POS_BOTTOM){f.x+=i}}}if(h==c.HS_POS_TOP){var k=c.layer.offsetHeight-c.HS_ARROW_HEIGHT*2;b.y-=k;f.y+=k}if(f){f.x+=c.HS_ARROW_WIDTH;f.y+=c.HS_ARROW_HEIGHT;c.positionDiv(c.arrow,f.x,f.y);c.arrow.style.backgroundPosition=-((h-1)*c.HS_ARROW_WIDTH)+"px 0";c.arrow.style.display="block"}else{c.arrow.style.display="none"}b.x-=c.HS_ARROW_WIDTH;b.y-=c.HS_ARROW_HEIGHT;c.layer.style.padding=c.HS_ARROW_HEIGHT+"px "+c.HS_ARROW_WIDTH+"px";c.positionDiv(c.layer,b.x,b.y)},0)}if(!this.oldpos||e.x!=this.oldpos.x||e.y!=this.oldpos.y){this.startFadeIn();this.oldpos=e}else{this.layer.style.display="block"}},back:function(){if(this.step>0){this.step--;this.show()}},next:function(){if(this.step<this.steps.length-1){this.step++;this.show()}},end:function(){this.layer.onclick=null;this.layer.style.display="none"},eventHandler:function(b){var a=Event.element(b);if(/hs-(\w+)/.test(a.className)){if(this[RegExp.$1]){this[RegExp.$1]();Event.stop(b);return false}}},positionDiv:function(c,a,b){c.style.left=Math.floor(a)+"px";c.style.top=Math.floor(b)+"px"},FADEIN_SPEED:300,FADEIN_FRAMES:16,startFadeIn:function(){var d=0;var b=Math.floor(this.FADEIN_SPEED/this.FADEIN_FRAMES);var c=this;function a(){var e=d<c.FADEIN_FRAMES?Math.sin((d*90/c.FADEIN_FRAMES)*Math.PI/180):1;AppUI.setOpacity(c.layer,e);d++;if(d<c.FADEIN_FRAMES){if(c.timeout){window.clearTimeout(c.timeout)}c.timeout=window.setTimeout(a,b)}}a();this.layer.style.display="block"}};